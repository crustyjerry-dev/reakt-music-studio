import React, { useState, useRef, useCallback, useEffect } from 'react';\nimport * as Tone from 'tone';\n\nconst Studio = ({ isStudio, setIsStudio }) => {\n  const patternRef = useRef(Array(16).fill(0));\n  const synthRef = useRef(null);\n  const kickRef = useRef(null);\n  const loopRef = useRef(null);\n\n  const generatePattern = useCallback(() => {\n    patternRef.current = Array.from({length: 16}, () => Math.random() < 0.25 ? 1 : 0);\n  }, []);\n\n  const initStudio = useCallback(async () => {\n    await Tone.start();\n    synthRef.current = new Tone.Synth().toDestination();\n    kickRef.current = new Tone.MembraneSynth({ pitchDecay: 0.05 }).toDestination();\n    Tone.Transport.bpm.value = 130;\n    generatePattern();\n    const loop = new Tone.Loop((time) => {\n      const step = Math.floor(Tone.Transport.ticks / 6) % 16;\n      if (patternRef.current[step]) {\n        kickRef.current.triggerAttackRelease('C1', '16n', time);\n      }\n      if (Math.random() < 0.15) {\n        synthRef.current.triggerAttackRelease(\n          Tone.Frequency(Math.random() * 400 + 200).toNote(),\n          '8n',\n          time\n        );\n      }\n    }, '16n');\n    loopRef.current = loop;\n    loop.start(0);\n  }, [generatePattern]);\n\n  const toggleStudio = useCallback(async () => {\n    if (isStudio) {\n      if (Tone.Transport.state === 'started') {\n        Tone.Transport.stop();\n      }\n      if (loopRef.current) {\n        loopRef.current.dispose();\n        loopRef.current = null;\n      }\n      if (synthRef.current) {\n        synthRef.current.dispose();\n        synthRef.current = null;\n      }\n      if (kickRef.current) {\n        kickRef.current.dispose();\n        kickRef.current = null;\n      }\n      setIsStudio(false);\n    } else {\n      await initStudio();\n      setIsStudio(true);\n    }\n  }, [isStudio, initStudio, setIsStudio]);\n\n  const playStop = useCallback(() => {\n    if (Tone.Transport.state === 'started') {\n      Tone.Transport.stop();\n    } else {\n      Tone.Transport.start();\n    }\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      if (loopRef.current) loopRef.current.dispose();\n      if (synthRef.current) synthRef.current.dispose();\n      if (kickRef.current) kickRef.current.dispose();\n      Tone.Transport.stop();\n    };\n  }, []);\n\n  return (\n    <div style={{ position: 'absolute', bottom: 20, right: 20, background: 'rgba(0,0,0,0.7)', padding: '10px', borderRadius: '8px', fontSize: '12px' }}>\n      <button onClick={toggleStudio} style={{ marginBottom: '5px', padding: '4px 8px' }}>\n        {isStudio ? 'Exit Studio' : 'Enter Studio'}\n      </button>\n      {isStudio && (\n        <>\n          <button onClick={generatePattern} style={{ marginRight: '5px', padding: '4px 6px', fontSize: '11px' }}>Gen Beats</button>\n          <button onClick={playStop} style={{ padding: '4px 6px', fontSize: '11px' }}>\n            {Tone.Transport.state === 'started' ? 'Stop' : 'Play'}\n          </button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default Studio;