import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { db, query, orderByChild, limitToLast, onValue, push, serverTimestamp, ref } from '../firebase.js';\n\nconst Chat = ({ uid }) => {\n  const [messages, setMessages] = useState([]);\n  const [messageText, setMessageText] = useState('');\n  const messagesQuery = useMemo(() => query(ref(db, 'messages'), orderByChild('time'), limitToLast(50)), []);\n\n  useEffect(() => {\n    const unsubscribe = onValue(messagesQuery, (snapshot) => {\n      const msgs = [];\n      snapshot.forEach((childSnapshot) => {\n        msgs.push(childSnapshot.val());\n      });\n      setMessages(msgs);\n    });\n    return unsubscribe;\n  }, [messagesQuery]);\n\n  const sendMessage = useCallback(async () => {\n    if (!uid || !messageText.trim()) return;\n    try {\n      await push(ref(db, 'messages'), {\n        uid: uid.slice(0,8),\n        text: messageText.trim(),\n        time: serverTimestamp(),\n      });\n      setMessageText('');\n    } catch (err) {\n      console.error(err);\n    }\n  }, [uid, messageText]);\n\n  return (\n    <div style={{ marginTop: '10px', fontSize: '12px' }}>\n      <div style={{ height: '120px', overflowY: 'auto', background: 'rgba(0,0,0,0.8)', padding: '5px', borderRadius: '4px' }}>\n        {messages.slice(-10).map((m, i) => (\n          <div key={i} style={{ marginBottom: '2px' }}>\n            <span style={{ color: '#00ff00' }}>{m.uid}:</span> {m.text}\n          </div>\n        ))}\n      </div>\n      <form onSubmit={(e) => { e.preventDefault(); sendMessage(); }} style={{ marginTop: '5px' }}>\n        <input \n          value={messageText}\n          onChange={(e) => setMessageText(e.target.value)}\n          placeholder="Chat..."\n          style={{ width: '140px', padding: '2px', fontSize: '12px', background: 'rgba(0,0,0,0.5)', color: 'white', border: '1px solid #444' }}\n          maxLength={100}\n        />\n        <button type="submit" style={{ padding: '2px 8px', fontSize: '12px', marginLeft: '5px' }}>Send</button>\n      </form>\n    </div>\n  );\n};\n\nexport default Chat;